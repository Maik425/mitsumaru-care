## ADDED Requirements

### Requirement: シフト形態マスター管理機能

システム管理者および施設管理者は、シフト形態マスターを登録・管理できる。

#### Scenario: 施設管理者によるシフト形態登録

- **WHEN** 施設管理者が新しいシフト形態情報を入力して登録ボタンをクリック
- **THEN** shiftsテーブルにレコードが追加される
- **AND** 作成されたシフト形態は施設管理者の所属施設に自動的に紐づけられる

#### Scenario: システム管理者によるシフト形態登録

- **WHEN** システム管理者が新しいシフト形態情報を入力して登録ボタンをクリック
- **THEN** shiftsテーブルにレコードが追加される
- **AND** システム管理者は任意の施設を選択してシフト形態を紐づけられる

#### Scenario: シフト形態登録時のバリデーション

- **WHEN** 必須項目が未入力または無効な値が入力された場合
- **THEN** 適切なエラーメッセージが表示される
- **AND** シフト形態登録は実行されない

### Requirement: シフト形態一覧表示機能

管理者は、管理対象のシフト形態一覧を表示できる。

#### Scenario: 施設管理者によるシフト形態一覧表示

- **WHEN** 施設管理者がシフト形態管理画面にアクセス
- **THEN** 所属施設のシフト形態のみが一覧表示される
- **AND** 各シフト形態の基本情報（名前、勤務時間、休憩時間、色コード）が表示される

#### Scenario: システム管理者によるシフト形態一覧表示

- **WHEN** システム管理者がシフト形態管理画面にアクセス
- **THEN** 全施設のシフト形態が一覧表示される
- **AND** 施設別フィルタリング機能が利用できる

### Requirement: シフト形態編集機能

管理者は、既存のシフト形態情報を編集できる。

#### Scenario: シフト形態情報の更新

- **WHEN** 管理者がシフト形態情報を編集して保存ボタンをクリック
- **THEN** shiftsテーブルの該当レコードが更新される
- **AND** 変更内容が即座に一覧に反映される

#### Scenario: 権限による編集制限

- **WHEN** 施設管理者が他施設のシフト形態情報を編集しようとした場合
- **THEN** エラーメッセージが表示される
- **AND** 編集は実行されない

### Requirement: シフト形態削除機能

管理者は、不要になったシフト形態を削除できる。

#### Scenario: シフト形態の削除

- **WHEN** 管理者がシフト形態削除ボタンをクリックして確認する
- **THEN** shiftsテーブルからレコードが削除される
- **AND** 関連するシフト割り当てや勤怠記録は保持される（外部キー制約による）

### Requirement: 夜勤シフト対応機能

システムは、日をまたぐ夜勤シフトを適切に処理できる。

#### Scenario: 夜勤シフトの登録

- **WHEN** 管理者が夜勤シフト（例：22:00-09:00）を登録する
- **THEN** is_night_shiftフラグが自動的にtrueに設定される
- **AND** 勤務時間が正しく計算される（11時間）

#### Scenario: 夜勤シフトの勤務時間計算

- **WHEN** 夜勤シフトの勤務時間を計算する
- **THEN** 日をまたぐ時間が正しく計算される
- **AND** 休憩時間が適切に差し引かれる

### Requirement: シフト形態並び替え機能

管理者は、シフト形態の表示順序を変更できる。

#### Scenario: シフト形態の並び替え

- **WHEN** 管理者がシフト形態の順序を変更する
- **THEN** sort_orderカラムが更新される
- **AND** 一覧表示の順序が変更される

## MODIFIED Requirements

### Requirement: シフト作成システム

既存のシフト作成システムにシフト形態データを統合する。

#### Scenario: シフト作成時の形態選択

- **WHEN** 管理者がシフトを作成する
- **THEN** 所属施設のシフト形態一覧から選択できる
- **AND** 選択されたシフト形態の勤務時間が自動的に設定される

#### Scenario: シフト形態に基づく勤務時間設定

- **WHEN** 管理者がシフト形態を選択する
- **THEN** 開始時刻、終了時刻、休憩時間が自動的に設定される
- **AND** 夜勤シフトの場合は適切に処理される

### Requirement: シフト編集システム

既存のシフト編集システムにシフト形態データを統合する。

#### Scenario: シフト編集時の形態変更

- **WHEN** 管理者が既存シフトの形態を変更する
- **THEN** 新しいシフト形態の勤務時間が適用される
- **AND** 既存の勤怠記録との整合性が保たれる

### Requirement: 勤怠管理システム

既存の勤怠管理システムにシフト形態データを統合する。

#### Scenario: 勤怠記録でのシフト形態表示

- **WHEN** 管理者が勤怠記録を表示する
- **THEN** 各職員のシフト形態情報が表示される
- **AND** シフト形態に基づく勤務時間が正しく計算される

#### Scenario: 夜勤シフトの勤怠記録

- **WHEN** 夜勤シフトの勤怠記録を作成する
- **THEN** 日をまたぐ勤務時間が正しく計算される
- **AND** 休憩時間が適切に処理される

### Requirement: シフト交換システム

既存のシフト交換システムにシフト形態データを統合する。

#### Scenario: シフト交換時の形態確認

- **WHEN** 職員がシフト交換を申請する
- **THEN** 交換対象のシフト形態が表示される
- **AND** 勤務時間の違いが明確に示される

#### Scenario: 異なるシフト形態間の交換

- **WHEN** 異なるシフト形態間でシフト交換が行われる
- **THEN** 勤務時間の差が計算される
- **AND** 適切な調整が提案される
