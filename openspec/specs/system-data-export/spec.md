## ADDED Requirements

### Requirement: 勤怠記録エクスポート機能

MUST: システム管理者は勤怠記録をCSV/Excel形式でエクスポートできる。

#### Scenario: 勤怠記録の期間指定エクスポート

- **WHEN** システム管理者が勤怠記録エクスポート画面で期間を指定してエクスポートを実行する
- **THEN** 指定期間の勤怠記録がCSV/Excel形式でエクスポートされる
- **AND** ユーザー名、日付、勤務時間、休憩時間、残業時間が含まれる

#### Scenario: 施設別勤怠記録エクスポート

- **WHEN** システム管理者が特定の施設を選択して勤怠記録をエクスポートする
- **THEN** 該当施設の勤怠記録のみがエクスポートされる
- **AND** 施設名がエクスポートファイルに含まれる

#### Scenario: 勤怠記録エクスポート条件設定

- **WHEN** システム管理者が勤怠記録エクスポートの条件を設定する
- **THEN** エクスポート条件が保存される
- **AND** 保存した条件でエクスポートが実行される

### Requirement: ユーザー情報エクスポート機能

MUST: システム管理者はユーザー情報をCSV/Excel形式でエクスポートできる。

#### Scenario: 全ユーザー情報のエクスポート

- **WHEN** システム管理者がユーザー情報エクスポートを実行する
- **THEN** 全ユーザーの情報がCSV/Excel形式でエクスポートされる
- **AND** ユーザー名、メール、ロール、所属施設、登録日が含まれる

#### Scenario: 施設別ユーザー情報エクスポート

- **WHEN** システム管理者が特定の施設を選択してユーザー情報をエクスポートする
- **THEN** 該当施設のユーザー情報のみがエクスポートされる
- **AND** 施設名がエクスポートファイルに含まれる

#### Scenario: ユーザー情報エクスポート項目選択

- **WHEN** システム管理者がエクスポート項目を選択する
- **THEN** 選択した項目のみがエクスポートされる
- **AND** エクスポート項目の設定が保存される

### Requirement: 施設情報エクスポート機能

MUST: システム管理者は施設情報をCSV/Excel形式でエクスポートできる。

#### Scenario: 全施設情報のエクスポート

- **WHEN** システム管理者が施設情報エクスポートを実行する
- **THEN** 全施設の情報がCSV/Excel形式でエクスポートされる
- **AND** 施設名、住所、電話番号、メール、登録日が含まれる

#### Scenario: 施設統計情報のエクスポート

- **WHEN** システム管理者が施設統計情報エクスポートを実行する
- **THEN** 各施設の統計情報がCSV/Excel形式でエクスポートされる
- **AND** ユーザー数、勤怠記録数、利用状況が含まれる

### Requirement: エクスポート履歴管理機能

MUST: システム管理者はエクスポート履歴を管理できる。

#### Scenario: エクスポート履歴の表示

- **WHEN** システム管理者がエクスポート履歴画面にアクセスする
- **THEN** 過去のエクスポート履歴が表示される
- **AND** エクスポート日時、対象データ、ファイル名、ファイルサイズが表示される

#### Scenario: エクスポートファイルの再ダウンロード

- **WHEN** システム管理者がエクスポート履歴からファイルを再ダウンロードする
- **THEN** エクスポートファイルがダウンロードされる
- **AND** 再ダウンロード履歴が記録される

#### Scenario: エクスポート履歴の削除

- **WHEN** システム管理者がエクスポート履歴を削除する
- **THEN** エクスポート履歴が削除される
- **AND** 関連するファイルも削除される

### Requirement: エクスポート設定管理機能

MUST: システム管理者はエクスポート設定を管理できる。

#### Scenario: エクスポート形式の選択

- **WHEN** システム管理者がエクスポート形式を選択する
- **THEN** 選択した形式でエクスポートが実行される
- **AND** エクスポート形式の設定が保存される

#### Scenario: エクスポート項目の選択

- **WHEN** システム管理者がエクスポート項目を選択する
- **THEN** 選択した項目のみがエクスポートされる
- **AND** エクスポート項目の設定が保存される

#### Scenario: エクスポートテンプレートの管理

- **WHEN** システム管理者がエクスポートテンプレートを作成する
- **THEN** エクスポートテンプレートが保存される
- **AND** 保存したテンプレートでエクスポートが実行される

### Requirement: エクスポート進捗表示機能

MUST: システム管理者はエクスポートの進捗を確認できる。

#### Scenario: エクスポート進捗の表示

- **WHEN** システム管理者がエクスポートを実行する
- **THEN** エクスポートの進捗が表示される
- **AND** 進捗率と残り時間が表示される

#### Scenario: エクスポート完了通知

- **WHEN** エクスポートが完了する
- **THEN** 完了通知が表示される
- **AND** ダウンロードリンクが提供される

#### Scenario: エクスポートエラーの表示

- **WHEN** エクスポート中にエラーが発生する
- **THEN** エラーメッセージが表示される
- **AND** エラーの詳細と対処法が表示される

### Requirement: エクスポート権限制御機能

MUST: システム管理者はエクスポート権限を制御できる。

#### Scenario: エクスポート権限のチェック

- **WHEN** システム管理者がエクスポートを実行する
- **THEN** エクスポート権限がチェックされる
- **AND** 権限がない場合はエクスポートが拒否される

#### Scenario: データアクセス制御

- **WHEN** システム管理者が特定のデータをエクスポートしようとする
- **THEN** データアクセス権限がチェックされる
- **AND** アクセス権限がないデータは除外される

#### Scenario: エクスポート履歴の監査

- **WHEN** システム管理者がエクスポートを実行する
- **THEN** エクスポート履歴が監査ログに記録される
- **AND** エクスポート内容と実行者が記録される
