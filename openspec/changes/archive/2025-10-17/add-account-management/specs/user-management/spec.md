## ADDED Requirements

### Requirement: アカウント作成機能

システム管理者および施設管理者は、新しいユーザーアカウントを作成できる。

#### Scenario: 施設管理者によるアカウント作成

- **WHEN** 施設管理者が新しいアカウント情報を入力して作成ボタンをクリック
- **THEN** Supabase Authにユーザーが作成され、usersテーブルにレコードが追加される
- **AND** 作成されたユーザーは施設管理者の所属施設に自動的に紐づけられる

#### Scenario: システム管理者によるアカウント作成

- **WHEN** システム管理者が新しいアカウント情報を入力して作成ボタンをクリック
- **THEN** Supabase Authにユーザーが作成され、usersテーブルにレコードが追加される
- **AND** システム管理者は任意の施設を選択してユーザーを紐づけられる

#### Scenario: アカウント作成時のバリデーション

- **WHEN** 必須項目が未入力または無効な値が入力された場合
- **THEN** 適切なエラーメッセージが表示される
- **AND** アカウント作成は実行されない

### Requirement: アカウント一覧表示機能

管理者は、管理対象のユーザーアカウント一覧を表示できる。

#### Scenario: 施設管理者によるアカウント一覧表示

- **WHEN** 施設管理者がアカウント管理画面にアクセス
- **THEN** 所属施設のユーザーのみが一覧表示される
- **AND** 各ユーザーの基本情報（名前、メール、役職、ステータス）が表示される

#### Scenario: システム管理者によるアカウント一覧表示

- **WHEN** システム管理者がアカウント管理画面にアクセス
- **THEN** 全施設のユーザーが一覧表示される
- **AND** 施設別フィルタリング機能が利用できる

### Requirement: アカウント編集機能

管理者は、既存のユーザーアカウント情報を編集できる。

#### Scenario: アカウント情報の更新

- **WHEN** 管理者がユーザー情報を編集して保存ボタンをクリック
- **THEN** usersテーブルの該当レコードが更新される
- **AND** 変更内容が即座に一覧に反映される

#### Scenario: 権限による編集制限

- **WHEN** 施設管理者が他施設のユーザー情報を編集しようとした場合
- **THEN** エラーメッセージが表示される
- **AND** 編集は実行されない

### Requirement: アカウント削除機能

管理者は、不要になったユーザーアカウントを削除できる。

#### Scenario: アカウントの完全削除

- **WHEN** 管理者がユーザー削除ボタンをクリックして確認する
- **THEN** Supabase Authからユーザーが削除される
- **AND** usersテーブルからもレコードが削除される
- **AND** 関連する勤怠記録等は保持される（外部キー制約による）

### Requirement: アカウント有効/無効化機能

管理者は、ユーザーアカウントの有効/無効状態を切り替えできる。

#### Scenario: アカウントの無効化

- **WHEN** 管理者がアカウント無効化ボタンをクリック
- **THEN** usersテーブルのis_activeフラグがfalseに更新される
- **AND** 該当ユーザーはログインできなくなる

#### Scenario: アカウントの有効化

- **WHEN** 管理者が無効化されたアカウントの有効化ボタンをクリック
- **THEN** usersテーブルのis_activeフラグがtrueに更新される
- **AND** 該当ユーザーは再びログインできるようになる

## MODIFIED Requirements

### Requirement: ユーザー認証システム

既存の認証システムにアカウント管理機能を統合する。

#### Scenario: アカウント管理画面へのアクセス制御

- **WHEN** 認証された管理者がアカウント管理画面にアクセス
- **THEN** 適切な権限チェックが実行される
- **AND** 権限に応じた機能が表示される

#### Scenario: 新規作成ユーザーのログイン

- **WHEN** 新規作成されたユーザーが初回ログインを試行
- **THEN** 正常にログインできる
- **AND** 適切なダッシュボードにリダイレクトされる
