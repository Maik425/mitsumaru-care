## ADDED Requirements

### Requirement: ユーザー操作ログ記録機能

MUST: システムはユーザーのすべての重要な操作を記録する。

#### Scenario: ログイン・ログアウトログの記録

- **WHEN** ユーザーがログインまたはログアウトする
- **THEN** ログイン・ログアウトイベントが記録される
- **AND** ユーザーID、日時、IPアドレス、ユーザーエージェントが記録される

#### Scenario: データ変更操作ログの記録

- **WHEN** ユーザーがデータの作成・更新・削除を行う
- **THEN** データ変更操作が記録される
- **AND** 操作者、操作内容、変更前後の値、日時が記録される

#### Scenario: 権限変更操作ログの記録

- **WHEN** 管理者がユーザーの権限を変更する
- **THEN** 権限変更操作が記録される
- **AND** 変更者、対象ユーザー、変更内容、日時が記録される

### Requirement: システム変更履歴記録機能

MUST: システムはシステム設定や構成の変更を記録する。

#### Scenario: システム設定変更ログの記録

- **WHEN** システム管理者がシステム設定を変更する
- **THEN** 設定変更が記録される
- **AND** 変更者、変更項目、変更前後の値、日時が記録される

#### Scenario: 施設設定変更ログの記録

- **WHEN** 管理者が施設設定を変更する
- **THEN** 施設設定変更が記録される
- **AND** 変更者、対象施設、変更内容、日時が記録される

#### Scenario: データベーススキーマ変更ログの記録

- **WHEN** データベーススキーマが変更される
- **THEN** スキーマ変更が記録される
- **AND** 変更者、変更内容、実行日時が記録される

### Requirement: セキュリティイベントログ記録機能

MUST: システムはセキュリティ関連のイベントを記録する。

#### Scenario: 認証失敗ログの記録

- **WHEN** ユーザーがログインに失敗する
- **THEN** 認証失敗イベントが記録される
- **AND** ユーザーID、IPアドレス、失敗理由、日時が記録される

#### Scenario: 権限違反ログの記録

- **WHEN** ユーザーが権限のない操作を試行する
- **THEN** 権限違反イベントが記録される
- **AND** ユーザーID、試行操作、IPアドレス、日時が記録される

#### Scenario: 異常アクセスログの記録

- **WHEN** 異常なアクセスパターンが検出される
- **THEN** 異常アクセスイベントが記録される
- **AND** アクセスパターン、IPアドレス、検出日時が記録される

### Requirement: 監査ログ表示機能

MUST: システム管理者は監査ログを表示・確認できる。

#### Scenario: ログ一覧の表示

- **WHEN** システム管理者が監査ログ画面にアクセスする
- **THEN** ログ一覧が表示される
- **AND** ログタイプ、操作者、操作内容、日時が表示される

#### Scenario: ログ詳細の表示

- **WHEN** システム管理者がログ項目をクリックする
- **THEN** ログの詳細情報が表示される
- **AND** 操作の詳細、変更内容、関連情報が表示される

#### Scenario: ログ統計の表示

- **WHEN** システム管理者がログ統計を表示する
- **THEN** ログの統計情報が表示される
- **AND** ログ数、操作タイプ別統計、期間別統計が表示される

### Requirement: ログ検索・フィルタリング機能

MUST: システム管理者は監査ログを検索・フィルタリングできる。

#### Scenario: ログ検索機能

- **WHEN** システム管理者がログ検索条件を入力する
- **THEN** 条件に合致するログが表示される
- **AND** 検索結果の件数が表示される

#### Scenario: ログフィルタリング機能

- **WHEN** システム管理者がログフィルターを設定する
- **THEN** フィルター条件に合致するログのみが表示される
- **AND** フィルター条件が明確に表示される

#### Scenario: 日付範囲指定機能

- **WHEN** システム管理者が日付範囲を指定する
- **THEN** 指定期間内のログのみが表示される
- **AND** 期間外のログは除外される

### Requirement: ログ分析・レポート機能

MUST: システム管理者は監査ログの分析・レポート機能を利用できる。

#### Scenario: ログトレンド分析

- **WHEN** システム管理者がログトレンドを表示する
- **THEN** 期間別のログ数推移がグラフで表示される
- **AND** 異常な増加や減少が視覚的に確認できる

#### Scenario: 異常検知アラート

- **WHEN** 異常なログパターンが検出される
- **THEN** アラートが表示される
- **AND** 異常の詳細と推奨対応が表示される

#### Scenario: ログレポート生成

- **WHEN** システム管理者がログレポートを生成する
- **THEN** 指定期間のログレポートが生成される
- **AND** CSVまたはPDF形式でダウンロードできる

### Requirement: ログ保持期間管理機能

MUST: システム管理者は監査ログの保持期間を管理できる。

#### Scenario: ログ保持期間の設定

- **WHEN** システム管理者がログ保持期間を設定する
- **THEN** ログ保持期間が保存される
- **AND** 設定した期間でログが自動削除される

#### Scenario: ログ自動削除の実行

- **WHEN** ログ保持期間が経過する
- **THEN** 期限切れのログが自動削除される
- **AND** 削除されたログの件数が記録される

#### Scenario: ログ保持期間の延長

- **WHEN** システム管理者がログ保持期間を延長する
- **THEN** 既存のログも新しい保持期間で管理される
- **AND** 延長履歴が記録される
