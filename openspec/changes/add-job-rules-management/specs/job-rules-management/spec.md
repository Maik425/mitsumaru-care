## ADDED Requirements

### Requirement: 職種マスター管理機能

MUST: システム管理者および施設管理者は職種マスターを登録・管理できる。

#### Scenario: 施設管理者による職種登録

- **WHEN** 施設管理者が新しい職種情報を入力して登録ボタンをクリック
- **THEN** job_typesテーブルにレコードが追加される
- **AND** 作成された職種は施設管理者の所属施設に自動的に紐づけられる

#### Scenario: システム管理者による職種登録

- **WHEN** システム管理者が新しい職種情報を入力して登録ボタンをクリック
- **THEN** job_typesテーブルにレコードが追加される
- **AND** システム管理者は任意の施設を選択して職種を紐づけられる

### Requirement: エリアマスター管理機能

MUST: システム管理者および施設管理者はエリアマスターを登録・管理できる。

#### Scenario: 施設管理者によるエリア登録

- **WHEN** 施設管理者が新しいエリア情報を入力して登録ボタンをクリック
- **THEN** areasテーブルにレコードが追加される
- **AND** 作成されたエリアは施設管理者の所属施設に自動的に紐づけられる

#### Scenario: カスタムエリアの登録

- **WHEN** 管理者がカスタムエリア名を入力して登録する
- **THEN** カスタムエリア名がareasテーブルに保存される
- **AND** 他の配置ルールでも利用可能になる

### Requirement: 配置ルールテンプレート管理機能

MUST: 管理者は配置ルールテンプレートを登録・管理できる。

#### Scenario: 配置ルールテンプレートの作成

- **WHEN** 管理者がテンプレート名、説明、職種・エリアセットを入力して保存
- **THEN** job_rule_templatesテーブルにレコードが追加される
- **AND** 関連するjob_rule_setsテーブルにもセット情報が保存される

#### Scenario: 配置ルールテンプレートの編集

- **WHEN** 管理者が既存の配置ルールテンプレートを編集して保存
- **THEN** テンプレート情報とセット情報が更新される
- **AND** 変更内容が即座に一覧に反映される

#### Scenario: 配置ルールテンプレートの削除

- **WHEN** 管理者が配置ルールテンプレートを削除する
- **THEN** テンプレートと関連するセット情報が削除される
- **AND** 既存のシフトデータは保持される

### Requirement: 配置ルール適用機能

MUST: 管理者は配置ルールテンプレートをシフト作成に適用できる。

#### Scenario: シフト作成時の配置ルール適用

- **WHEN** 管理者がシフト作成時に配置ルールテンプレートを選択する
- **THEN** テンプレートに基づく職員配置が自動提案される
- **AND** 最小・最大配置人数が表示される

#### Scenario: 配置ルール違反の検出

- **WHEN** 管理者が配置ルールに違反する職員配置を行う
- **THEN** 警告メッセージが表示される
- **AND** 適切な配置案が提案される

### Requirement: 施設別配置ルール管理機能

MUST: 管理者は所属施設の配置ルールのみを管理できる。

#### Scenario: 施設管理者による配置ルール表示

- **WHEN** 施設管理者が配置ルール管理画面にアクセス
- **THEN** 所属施設の配置ルールのみが表示される
- **AND** 他施設の配置ルールは表示されない

#### Scenario: システム管理者による全施設配置ルール表示

- **WHEN** システム管理者が配置ルール管理画面にアクセス
- **THEN** 全施設の配置ルールが表示される
- **AND** 施設別フィルタリング機能が利用できる

### Requirement: シフト作成システム統合機能

MUST: 既存のシフト作成システムは配置ルールテンプレートを統合する。

#### Scenario: シフト作成時の配置ルール選択

- **WHEN** 管理者がシフトを作成する
- **THEN** 所属施設の配置ルールテンプレート一覧から選択できる
- **AND** 選択されたテンプレートに基づく職員配置が提案される

#### Scenario: 配置ルールに基づく職員配置

- **WHEN** 管理者が配置ルールテンプレートを適用する
- **THEN** 職種・エリア別の職員配置が自動的に設定される
- **AND** 最小・最大配置人数が考慮される

### Requirement: シフト編集システム統合機能

MUST: 既存のシフト編集システムは配置ルールテンプレートを統合する。

#### Scenario: シフト編集時の配置ルール変更

- **WHEN** 管理者が既存シフトの配置ルールを変更する
- **THEN** 新しい配置ルールに基づく職員配置が提案される
- **AND** 既存の職員配置との整合性が確認される

### Requirement: 役割表管理システム統合機能

MUST: 既存の役割表管理システムは配置ルールテンプレートを統合する。

#### Scenario: 役割表での配置ルール適用

- **WHEN** 管理者が役割表を作成・編集する
- **THEN** 配置ルールテンプレートを選択して適用できる
- **AND** 職種・エリア別の職員配置が自動的に設定される

#### Scenario: 配置ルールに基づく職員検索

- **WHEN** 管理者が特定の職種・エリア要件で職員を検索する
- **THEN** 該当する職種・エリアの職員が検索結果に表示される
- **AND** 配置ルールに基づく配置案が提案される

### Requirement: 職員配置最適化機能

MUST: システムは配置ルールに基づいて職員配置を最適化できる。

#### Scenario: 自動配置提案

- **WHEN** 管理者が配置ルールテンプレートを適用する
- **THEN** 職員の技能・経験・勤務可能時間を考慮した最適な配置が提案される
- **AND** 配置ルールの最小・最大人数要件が満たされる

#### Scenario: 配置バランスの調整

- **WHEN** 管理者が職員配置を調整する
- **THEN** 配置ルールに基づく適切な配置バランスが維持される
- **AND** 職員の負荷が均等に分散される
