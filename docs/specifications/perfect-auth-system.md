# å®Œç’§ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…æ–¹é‡ãƒ»æ‰‹é †æ›¸

## æ¦‚è¦

ç¾åœ¨ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å•é¡Œç‚¹ã‚’è§£æ±ºã—ã€Supabaseã‚’åŸºç›¤ã¨ã—ãŸå …ç‰¢ã§æ‹¡å¼µæ€§ã®é«˜ã„èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€å®Ÿè£…æ–¹é‡ã¨å…·ä½“çš„ãªå®Ÿè£…æ‰‹é †ã‚’çµ±åˆã—ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ç¾åœ¨ã®å•é¡Œç‚¹åˆ†æ

### 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å•é¡Œ

- **äºŒé‡ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: `useAuth`ãƒ•ãƒƒã‚¯ã¨`AuthContext`ãŒæ··åœ¨
- **è²¬ä»»ã®åˆ†æ•£**: èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡æ•°ç®‡æ‰€ã«æ•£åœ¨
- **å‹å®‰å…¨æ€§ã®æ¬ å¦‚**: ä¸é©åˆ‡ãªå‹ã‚­ãƒ£ã‚¹ãƒˆã®å¤šç”¨

### 2. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã®å•é¡Œ

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼ä¸æ•´åˆ**: ç•°ãªã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®è¤‡é›‘æ€§**: è¤‡æ•°ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸å‚™**: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒä¸è¶³

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å•é¡Œ

- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ä¸é©åˆ‡ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **ãƒˆãƒ¼ã‚¯ãƒ³å‡¦ç†**: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®å‡¦ç†ãŒä¸å®Œå…¨
- **èªè¨¼çŠ¶æ…‹ã®åŒæœŸ**: è¤‡æ•°ã®èªè¨¼çŠ¶æ…‹ãŒä¸æ•´åˆ

## å®Œç’§ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆæ–¹é‡

### 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡

#### å˜ä¸€è²¬ä»»ã®åŸå‰‡

- **èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**: èªè¨¼çŠ¶æ…‹ã®ç®¡ç†ã®ã¿
- **èªè¨¼ãƒ•ãƒƒã‚¯**: èªè¨¼æ“ä½œã®æä¾›ã®ã¿
- **èªè¨¼ã‚¬ãƒ¼ãƒ‰**: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®ã¿

#### å‹å®‰å…¨æ€§ã®ç¢ºä¿

- ã™ã¹ã¦ã®èªè¨¼é–¢é€£ã®å‹ã‚’å³å¯†ã«å®šç¾©
- å‹ã‚­ãƒ£ã‚¹ãƒˆã‚’æ’é™¤
- TypeScriptã®å‹æ¨è«–ã‚’æœ€å¤§é™æ´»ç”¨

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€

- çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å‹ã®å®šç¾©
- é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æä¾›
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æˆ¦ç•¥

#### Supabaseã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

```typescript
// ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š
const supabaseConfig = {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true,
    flowType: 'pkce' as const,
    storage: typeof window !== 'undefined' ? window.localStorage : undefined,
  },
};
```

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç®¡ç†

- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**: Supabaseã®`onAuthStateChange`ã‚’æ´»ç”¨
- **æ°¸ç¶šåŒ–**: é©åˆ‡ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é©åˆ‡ãªç„¡åŠ¹åŒ–

### 3. èªè¨¼ãƒ•ãƒ­ãƒ¼ã®è¨­è¨ˆ

#### ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†

1. **å…¥åŠ›æ¤œè¨¼**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®åŸºæœ¬æ¤œè¨¼
2. **Supabaseèªè¨¼**: `signInWithPassword`ã®å®Ÿè¡Œ
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—**: ã‚«ã‚¹ã‚¿ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã®æƒ…å ±å–å¾—
4. **çŠ¶æ…‹æ›´æ–°**: èªè¨¼çŠ¶æ…‹ã®æ›´æ–°
5. **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**: ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

#### ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†

1. **Supabaseãƒ­ã‚°ã‚¢ã‚¦ãƒˆ**: `signOut`ã®å®Ÿè¡Œ
2. **ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚¯ãƒªã‚¢**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚¯ãƒªã‚¢
3. **èªè¨¼çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
4. **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**: ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ

1. **åˆæœŸåŒ–æ™‚ãƒã‚§ãƒƒã‚¯**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—**: æœ‰åŠ¹ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
3. **çŠ¶æ…‹å¾©å…ƒ**: èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒ

## å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ types.ts           # èªè¨¼é–¢é€£ã®å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ config.ts          # èªè¨¼è¨­å®š
â”‚   â”‚   â”œâ”€â”€ errors.ts          # èªè¨¼ã‚¨ãƒ©ãƒ¼ã®å®šç¾©
â”‚   â”‚   â”œâ”€â”€ utils.ts           # èªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ middleware.ts      # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ client.ts          # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨Supabase
â”‚       â””â”€â”€ server.ts          # ã‚µãƒ¼ãƒãƒ¼ç”¨Supabase
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ use-auth.ts            # èªè¨¼ãƒ•ãƒƒã‚¯
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ auth-context.tsx       # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå»ƒæ­¢äºˆå®šï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ auth-provider.tsx  # èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
â”‚   â”‚   â”œâ”€â”€ auth-guard.tsx     # èªè¨¼ã‚¬ãƒ¼ãƒ‰
â”‚   â”‚   â””â”€â”€ login-form.tsx     # ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â””â”€â”€ ui/                    # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â””â”€â”€ loading-spinner.tsx # ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼
â””â”€â”€ server/
    â””â”€â”€ routers/
        â””â”€â”€ auth.ts            # èªè¨¼API
```

## å®Ÿè£…æ‰‹é †

### Phase 1: åŸºç›¤ã®æ§‹ç¯‰

#### 1.1 å‹å®šç¾©ã®ä½œæˆ

**`src/lib/auth/types.ts`**

```typescript
import type { Session } from '@supabase/supabase-js';

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«
export type UserRole = 'system_admin' | 'facility_admin' | 'user';

// èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼
export interface AuthUser {
  id: string;
  email: string;
  name: string;
  role: UserRole;
  facility_id?: string;
}

// èªè¨¼çŠ¶æ…‹
export interface AuthState {
  user: AuthUser | null;
  session: Session | null;
  loading: boolean;
  initialized: boolean;
}

// èªè¨¼æ“ä½œ
export interface AuthActions {
  signIn: (email: string, password: string) => Promise<AuthResult>;
  signOut: () => Promise<void>;
  refreshSession: () => Promise<void>;
}

// èªè¨¼çµæœ
export interface AuthResult {
  success: boolean;
  user?: AuthUser | null;
  error?: string;
}

// èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
export interface AuthContextType extends AuthState, AuthActions {}

// èªè¨¼ã‚¬ãƒ¼ãƒ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
export interface AuthGuardProps {
  children: React.ReactNode;
  requiredRole?: UserRole;
  fallback?: React.ReactNode;
  redirectTo?: string;
}

// ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼æƒ…å ±
export interface LoginCredentials {
  email: string;
  password: string;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ‡ãƒ¼ã‚¿
export interface RegisterData {
  email: string;
  password: string;
  name: string;
  role: UserRole;
  facility_id?: string;
}
```

#### 1.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

**`src/lib/auth/errors.ts`**

```typescript
export class AuthError extends Error {
  constructor(
    message: string,
    public code: string,
    public originalError?: Error
  ) {
    super(message);
    this.name = 'AuthError';
  }
}

export const AUTH_ERROR_CODES = {
  INVALID_CREDENTIALS: 'INVALID_CREDENTIALS',
  USER_NOT_FOUND: 'USER_NOT_FOUND',
  USER_INACTIVE: 'USER_INACTIVE',
  SESSION_EXPIRED: 'SESSION_EXPIRED',
  NETWORK_ERROR: 'NETWORK_ERROR',
  UNKNOWN_ERROR: 'UNKNOWN_ERROR',
} as const;

export type AuthErrorCode =
  (typeof AUTH_ERROR_CODES)[keyof typeof AUTH_ERROR_CODES];

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
export const AUTH_ERROR_MESSAGES: Record<AuthErrorCode, string> = {
  [AUTH_ERROR_CODES.INVALID_CREDENTIALS]:
    'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“',
  [AUTH_ERROR_CODES.USER_NOT_FOUND]: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
  [AUTH_ERROR_CODES.USER_INACTIVE]: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™',
  [AUTH_ERROR_CODES.SESSION_EXPIRED]: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸ',
  [AUTH_ERROR_CODES.NETWORK_ERROR]: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
  [AUTH_ERROR_CODES.UNKNOWN_ERROR]: 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
};

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
export function handleAuthError(error: unknown): AuthError {
  if (error instanceof AuthError) {
    return error;
  }

  if (error instanceof Error) {
    // Supabaseã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
    if (error.message.includes('Invalid login credentials')) {
      return new AuthError(
        AUTH_ERROR_MESSAGES[AUTH_ERROR_CODES.INVALID_CREDENTIALS],
        AUTH_ERROR_CODES.INVALID_CREDENTIALS,
        error
      );
    }

    if (error.message.includes('User not found')) {
      return new AuthError(
        AUTH_ERROR_MESSAGES[AUTH_ERROR_CODES.USER_NOT_FOUND],
        AUTH_ERROR_CODES.USER_NOT_FOUND,
        error
      );
    }

    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
    if (error.message.includes('Network') || error.message.includes('fetch')) {
      return new AuthError(
        AUTH_ERROR_MESSAGES[AUTH_ERROR_CODES.NETWORK_ERROR],
        AUTH_ERROR_CODES.NETWORK_ERROR,
        error
      );
    }
  }

  return new AuthError(
    AUTH_ERROR_MESSAGES[AUTH_ERROR_CODES.UNKNOWN_ERROR],
    AUTH_ERROR_CODES.UNKNOWN_ERROR,
    error instanceof Error ? error : undefined
  );
}
```

#### 1.3 èªè¨¼è¨­å®šã®å®Ÿè£…

**`src/lib/auth/config.ts`**

```typescript
// Supabaseèªè¨¼è¨­å®š
export const supabaseAuthConfig = {
  autoRefreshToken: true,
  persistSession: true,
  detectSessionInUrl: true,
  flowType: 'pkce' as const,
  storage: typeof window !== 'undefined' ? window.localStorage : undefined,
};

// èªè¨¼é–¢é€£ã®å®šæ•°
export const AUTH_CONSTANTS = {
  SESSION_STORAGE_KEY: 'auth:session',
  USER_STORAGE_KEY: 'auth:user',
  REFRESH_THRESHOLD: 60 * 1000, // 1åˆ†å‰ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
  MAX_RETRY_ATTEMPTS: 3,
  RETRY_DELAY: 1000, // 1ç§’
} as const;

// ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ãƒãƒƒãƒ”ãƒ³ã‚°
export const ROLE_PERMISSIONS = {
  system_admin: [
    'user:read',
    'user:create',
    'user:update',
    'user:delete',
    'facility:read',
    'facility:create',
    'facility:update',
    'facility:delete',
    'system:read',
    'system:update',
  ],
  facility_admin: [
    'staff:read',
    'staff:create',
    'staff:update',
    'attendance:read',
    'attendance:create',
    'attendance:update',
    'shift:read',
    'shift:create',
    'shift:update',
    'shift:delete',
    'holiday:read',
    'holiday:create',
    'holiday:update',
    'holiday:delete',
  ],
  user: [
    'attendance:read',
    'attendance:create',
    'holiday:read',
    'holiday:create',
  ],
} as const;

// ãƒ­ãƒ¼ãƒ«ã®æ—¥æœ¬èªè¡¨ç¤º
export const ROLE_LABELS = {
  system_admin: 'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…',
  facility_admin: 'æ–½è¨­ç®¡ç†è€…',
  user: 'ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼',
} as const;
```

#### 1.4 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®å®Ÿè£…

**`src/lib/auth/utils.ts`**

```typescript
import type { AuthUser, UserRole } from './types';
import { ROLE_PERMISSIONS } from './config';

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
export function hasPermission(user: AuthUser, permission: string): boolean {
  const userPermissions = ROLE_PERMISSIONS[user.role];
  return userPermissions.includes(permission);
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ­ãƒ¼ãƒ«ä»¥ä¸Šã‹ãƒã‚§ãƒƒã‚¯
export function hasRole(user: AuthUser, requiredRole: UserRole): boolean {
  const roleHierarchy: Record<UserRole, number> = {
    user: 1,
    facility_admin: 2,
    system_admin: 3,
  };

  return roleHierarchy[user.role] >= roleHierarchy[requiredRole];
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ¤œè¨¼
export function validateAuthUser(user: any): user is AuthUser {
  return (
    user &&
    typeof user.id === 'string' &&
    typeof user.email === 'string' &&
    typeof user.name === 'string' &&
    ['system_admin', 'facility_admin', 'user'].includes(user.role)
  );
}

// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
export function isSessionValid(session: any): boolean {
  if (!session) return false;

  const now = Date.now();
  const expiresAt = session.expires_at * 1000;

  return expiresAt > now;
}

// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãŒå¿…è¦ã‹ãƒã‚§ãƒƒã‚¯
export function shouldRefreshSession(session: any): boolean {
  if (!session) return false;

  const now = Date.now();
  const expiresAt = session.expires_at * 1000;
  const refreshThreshold = 60 * 1000; // 1åˆ†å‰

  return expiresAt - now < refreshThreshold;
}
```

#### 1.5 Supabaseè¨­å®šã®æœ€é©åŒ–

**`src/lib/supabase/client.ts`**

```typescript
import { createClient } from '@supabase/supabase-js';
import { supabaseAuthConfig } from '@/lib/auth/config';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error(
    `Missing Supabase environment variables: URL=${!!supabaseUrl}, Key=${!!supabaseAnonKey}`
  );
}

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®Supabaseã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: supabaseAuthConfig,
  global: {
    headers: {
      'X-Client-Info': 'supabase-js-web',
    },
  },
});
```

**`src/lib/supabase/server.ts`**

```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

if (!supabaseUrl || !supabaseServiceRoleKey) {
  throw new Error(
    `Missing Supabase environment variables: URL=${!!supabaseUrl}, ServiceRoleKey=${!!supabaseServiceRoleKey}`
  );
}

// ã‚µãƒ¼ãƒãƒ¼ç”¨ã®Supabaseã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {
  auth: {
    autoRefreshToken: false,
    persistSession: false,
  },
});
```

### Phase 2: èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å®Ÿè£…

#### 2.1 çµ±ä¸€ã•ã‚ŒãŸèªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

**`src/components/auth/auth-provider.tsx`**

```typescript
'use client';

import { supabase } from '@/lib/supabase/client';
import type { AuthContextType, AuthState, AuthUser } from '@/lib/auth/types';
import { handleAuthError } from '@/lib/auth/errors';
import { validateAuthUser } from '@/lib/auth/utils';
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { useRouter } from 'next/navigation';

const AuthContext = createContext<AuthContextType | null>(null);

interface AuthProviderProps {
  children: ReactNode;
}

export function AuthProvider({ children }: AuthProviderProps) {
  const [state, setState] = useState<AuthState>({
    user: null,
    session: null,
    loading: true,
    initialized: false,
  });

  const router = useRouter();

  // èªè¨¼çŠ¶æ…‹ã®åˆæœŸåŒ–
  const initializeAuth = async () => {
    try {
      setState(prev => ({ ...prev, loading: true }));

      const { data: { session }, error } = await supabase.auth.getSession();

      if (error) {
        console.error('Session initialization error:', error);
        setState(prev => ({ ...prev, loading: false, initialized: true }));
        return;
      }

      if (session?.user) {
        await fetchUserData(session.user.id);
      } else {
        setState(prev => ({
          ...prev,
          user: null,
          session: null,
          loading: false,
          initialized: true,
        }));
      }
    } catch (error) {
      console.error('Auth initialization error:', error);
      setState(prev => ({
        ...prev,
        user: null,
        session: null,
        loading: false,
        initialized: true,
      }));
    }
  };

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
  const fetchUserData = async (userId: string): Promise<AuthUser | null> => {
    try {
      const { data, error } = await supabase
        .from('users')
        .select('*')
        .eq('id', userId)
        .single();

      if (error || !data) {
        console.error('User data fetch error:', error);
        return null;
      }

      if (!data.is_active) {
        console.error('User account is inactive');
        return null;
      }

      const authUser: AuthUser = {
        id: data.id,
        email: data.email,
        name: data.name,
        role: data.role,
        facility_id: data.facility_id,
      };

      if (!validateAuthUser(authUser)) {
        console.error('Invalid user data structure');
        return null;
      }

      return authUser;
    } catch (error) {
      console.error('User data fetch error:', error);
      return null;
    }
  };

  // èªè¨¼çŠ¶æ…‹ã®å¤‰æ›´å‡¦ç†
  const handleAuthStateChange = async (event: string, session: any) => {
    console.log('Auth state change:', event, session?.user?.id);

    if (event === 'SIGNED_IN' && session?.user) {
      const user = await fetchUserData(session.user.id);
      setState(prev => ({
        ...prev,
        user,
        session,
        loading: false,
        initialized: true,
      }));
    } else if (event === 'SIGNED_OUT') {
      setState(prev => ({
        ...prev,
        user: null,
        session: null,
        loading: false,
        initialized: true,
      }));
    } else if (event === 'TOKEN_REFRESHED' && session) {
      setState(prev => ({
        ...prev,
        session,
      }));
    }
  };

  // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
  const signIn = async (email: string, password: string) => {
    try {
      setState(prev => ({ ...prev, loading: true }));

      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });

      if (error) {
        throw handleAuthError(error);
      }

      if (!data.user || !data.session) {
        throw handleAuthError(new Error('Login failed'));
      }

      const user = await fetchUserData(data.user.id);

      if (!user) {
        throw handleAuthError(new Error('User data not found'));
      }

      setState(prev => ({
        ...prev,
        user,
        session: data.session,
        loading: false,
      }));

      return { success: true, user };
    } catch (error) {
      const authError = handleAuthError(error);
      setState(prev => ({ ...prev, loading: false }));
      return { success: false, error: authError.message };
    }
  };

  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
  const signOut = async () => {
    try {
      setState(prev => ({ ...prev, loading: true }));

      const { error } = await supabase.auth.signOut();

      if (error) {
        throw handleAuthError(error);
      }

      setState(prev => ({
        ...prev,
        user: null,
        session: null,
        loading: false,
      }));

      router.push('/login');
    } catch (error) {
      const authError = handleAuthError(error);
      console.error('Logout error:', authError);

      // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã¯ã‚¯ãƒªã‚¢
      setState(prev => ({
        ...prev,
        user: null,
        session: null,
        loading: false,
      }));

      router.push('/login');
    }
  };

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–°å‡¦ç†
  const refreshSession = async () => {
    try {
      const { data, error } = await supabase.auth.refreshSession();

      if (error) {
        throw handleAuthError(error);
      }

      if (data.session) {
        setState(prev => ({
          ...prev,
          session: data.session,
        }));
      }
    } catch (error) {
      const authError = handleAuthError(error);
      console.error('Session refresh error:', authError);

      // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–°ã«å¤±æ•—ã—ãŸå ´åˆã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
      await signOut();
    }
  };

  // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
  useEffect(() => {
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      handleAuthStateChange
    );

    initializeAuth();

    return () => subscription.unsubscribe();
  }, []);

  const contextValue: AuthContextType = {
    ...state,
    signIn,
    signOut,
    refreshSession,
  };

  return (
    <AuthContext.Provider value={contextValue}>
      {children}
    </AuthContext.Provider>
  );
}

// èªè¨¼ãƒ•ãƒƒã‚¯
export function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

#### 2.2 èªè¨¼ã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£…

**`src/components/auth/auth-guard.tsx`**

```typescript
'use client';

import { useAuth } from './auth-provider';
import type { AuthGuardProps } from '@/lib/auth/types';
import { FullScreenLoadingSpinner } from '@/components/ui/loading-spinner';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';

export function AuthGuard({
  children,
  requiredRole,
  fallback,
  redirectTo = '/login'
}: AuthGuardProps) {
  const { user, loading, initialized } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!initialized) return;

    if (!user) {
      router.push(redirectTo);
      return;
    }

    if (requiredRole && user.role !== requiredRole) {
      // æ¨©é™ä¸è¶³ã®å ´åˆã¯é©åˆ‡ãªãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      switch (user.role) {
        case 'system_admin':
          router.push('/system/dashboard');
          break;
        case 'facility_admin':
          router.push('/facility/dashboard');
          break;
        case 'user':
          router.push('/user/dashboard');
          break;
        default:
          router.push('/login');
      }
      return;
    }
  }, [user, loading, initialized, requiredRole, router, redirectTo]);

  if (!initialized || loading) {
    return <FullScreenLoadingSpinner text="èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­..." />;
  }

  if (!user) {
    return fallback || null;
  }

  if (requiredRole && user.role !== requiredRole) {
    return fallback || null;
  }

  return <>{children}</>;
}
```

#### 2.3 ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®å®Ÿè£…

**`src/components/auth/login-form.tsx`**

```typescript
'use client';

import { useAuth } from './auth-provider';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { InlineLoadingSpinner } from '@/components/ui/loading-spinner';
import { useState } from 'react';
import { useRouter } from 'next/navigation';

export function LoginForm() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const { signIn } = useAuth();
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);

    try {
      const result = await signIn(email, password);

      if (result.success && result.user) {
        // ãƒ­ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        switch (result.user.role) {
          case 'system_admin':
            router.push('/system/dashboard');
            break;
          case 'facility_admin':
            router.push('/facility/dashboard');
            break;
          case 'user':
            router.push('/user/dashboard');
            break;
          default:
            router.push('/user/dashboard');
        }
      } else {
        setError(result.error || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('Login form error:', error);
      setError('ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Card className="w-full max-w-md mx-auto">
      <CardHeader>
        <CardTitle className="text-2xl text-center">ãƒ­ã‚°ã‚¤ãƒ³</CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          {error && (
            <Alert variant="destructive">
              <AlertDescription>{error}</AlertDescription>
            </Alert>
          )}

          <div className="space-y-2">
            <Label htmlFor="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</Label>
            <Input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              disabled={isLoading}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</Label>
            <Input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              disabled={isLoading}
            />
          </div>

          <Button
            type="submit"
            className="w-full"
            disabled={isLoading}
          >
            {isLoading ? (
              <div className="flex items-center gap-2">
                <InlineLoadingSpinner size="sm" />
                ãƒ­ã‚°ã‚¤ãƒ³ä¸­
              </div>
            ) : (
              'ãƒ­ã‚°ã‚¤ãƒ³'
            )}
          </Button>
        </form>
      </CardContent>
    </Card>
  );
}
```

### Phase 3: èªè¨¼æ“ä½œã®å®Ÿè£…

#### 3.1 ã‚µãƒ¼ãƒãƒ¼å´èªè¨¼APIã®å®Ÿè£…

**`src/server/routers/auth.ts`**

```typescript
import { supabaseAdmin } from '@/lib/supabase/server';
import type { AuthUser, LoginCredentials } from '@/lib/auth/types';
import { handleAuthError } from '@/lib/auth/errors';
import { TRPCError } from '@trpc/server';
import { z } from 'zod';
import { publicProcedure, router } from '../trpc';

export const authRouter = router({
  // ãƒ­ã‚°ã‚¤ãƒ³
  login: publicProcedure
    .input(
      z.object({
        email: z.string().email('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'),
        password: z.string().min(6, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
      })
    )
    .mutation(async ({ input }: { input: LoginCredentials }) => {
      try {
        // Supabaseã§èªè¨¼
        const { data, error } = await supabaseAdmin.auth.signInWithPassword({
          email: input.email,
          password: input.password,
        });

        if (error) {
          throw handleAuthError(error);
        }

        if (!data.user) {
          throw new TRPCError({
            code: 'UNAUTHORIZED',
            message: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ',
          });
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
        const { data: userData, error: userError } = await supabaseAdmin
          .from('users')
          .select('*')
          .eq('id', data.user.id)
          .single();

        if (userError || !userData) {
          throw new TRPCError({
            code: 'NOT_FOUND',
            message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
          });
        }

        if (!userData.is_active) {
          throw new TRPCError({
            code: 'FORBIDDEN',
            message: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™',
          });
        }

        const authUser: AuthUser = {
          id: userData.id,
          email: data.user.email!,
          name: userData.name,
          role: userData.role,
          facility_id: userData.facility_id,
        };

        return {
          user: authUser,
          session: data.session,
        };
      } catch (error) {
        if (error instanceof TRPCError) {
          throw error;
        }

        const authError = handleAuthError(error);
        throw new TRPCError({
          code: 'INTERNAL_SERVER_ERROR',
          message: authError.message,
        });
      }
    }),

  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  logout: publicProcedure.mutation(async () => {
    try {
      const { error } = await supabaseAdmin.auth.signOut();
      if (error) {
        throw handleAuthError(error);
      }
      return { success: true };
    } catch (error) {
      const authError = handleAuthError(error);
      throw new TRPCError({
        code: 'INTERNAL_SERVER_ERROR',
        message: authError.message,
      });
    }
  }),

  // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  getCurrentUser: publicProcedure.query(async () => {
    try {
      const {
        data: { user },
        error,
      } = await supabaseAdmin.auth.getUser();

      if (error || !user) {
        return null;
      }

      const { data: userData, error: userError } = await supabaseAdmin
        .from('users')
        .select('*')
        .eq('id', user.id)
        .single();

      if (userError || !userData) {
        return null;
      }

      const authUser: AuthUser = {
        id: userData.id,
        email: user.email!,
        name: userData.name,
        role: userData.role,
        facility_id: userData.facility_id,
      };

      return authUser;
    } catch (error) {
      return null;
    }
  }),

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
  getSession: publicProcedure.query(async () => {
    try {
      const {
        data: { session },
        error,
      } = await supabaseAdmin.auth.getSession();

      if (error || !session) {
        return null;
      }

      return session;
    } catch (error) {
      return null;
    }
  }),
});
```

#### 3.2 èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè£…

**`src/lib/auth/middleware.ts`**

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { supabaseAdmin } from '@/lib/supabase/server';

export async function authMiddleware(request: NextRequest) {
  const token = request.headers.get('authorization')?.replace('Bearer ', '');

  if (!token) {
    return NextResponse.json(
      { error: 'Authorization token required' },
      { status: 401 }
    );
  }

  try {
    const {
      data: { user },
      error,
    } = await supabaseAdmin.auth.getUser(token);

    if (error || !user) {
      return NextResponse.json({ error: 'Invalid token' }, { status: 401 });
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
    const { data: userData, error: userError } = await supabaseAdmin
      .from('users')
      .select('*')
      .eq('id', user.id)
      .single();

    if (userError || !userData || !userData.is_active) {
      return NextResponse.json(
        { error: 'User not found or inactive' },
        { status: 401 }
      );
    }

    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿½åŠ 
    request.headers.set('x-user-id', user.id);
    request.headers.set('x-user-role', userData.role);
    request.headers.set('x-user-facility-id', userData.facility_id || '');

    return NextResponse.next();
  } catch (error) {
    return NextResponse.json(
      { error: 'Authentication failed' },
      { status: 401 }
    );
  }
}
```

### Phase 4: çµ±åˆã¨ãƒ†ã‚¹ãƒˆ

#### 4.1 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒˆã®æ›´æ–°

**`src/app/layout.tsx`**

```typescript
import { AuthProvider } from '@/components/auth/auth-provider';
import { TRPCProvider } from '@/components/trpc-provider';
import { ThemeProvider } from '@/components/theme-provider';
import { Toaster } from '@/components/ui/toaster';
import './globals.css';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ja">
      <body>
        <ThemeProvider>
          <TRPCProvider>
            <AuthProvider>
              {children}
              <Toaster />
            </AuthProvider>
          </TRPCProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}
```

#### 4.2 ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°

**`src/app/login/page.tsx`**

```typescript
import { LoginForm } from '@/components/auth/login-form';

export default function LoginPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <LoginForm />
    </div>
  );
}
```

**`src/app/system/dashboard/page.tsx`**

```typescript
import { AuthGuard } from '@/components/auth/auth-guard';
import { SystemDashboard } from '@/components/system-dashboard';

export default function SystemDashboardPage() {
  return (
    <AuthGuard requiredRole="system_admin">
      <SystemDashboard />
    </AuthGuard>
  );
}
```

#### 4.3 æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç½®ãæ›ãˆæ‰‹é †

1. **æ—¢å­˜ã®èªè¨¼ãƒ•ãƒƒã‚¯ã®ç½®ãæ›ãˆ**

   ```bash
   # æ—¢å­˜ã®useAuthãƒ•ãƒƒã‚¯ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   mv src/hooks/use-auth.ts src/hooks/use-auth.ts.backup

   # æ–°ã—ã„èªè¨¼ãƒ•ãƒƒã‚¯ã‚’ä½œæˆ
   # (AuthProviderå†…ã®useAuthã‚’ä½¿ç”¨)
   ```

2. **æ—¢å­˜ã®AuthContextã®ç½®ãæ›ãˆ**

   ```bash
   # æ—¢å­˜ã®AuthContextã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   mv src/contexts/auth-context.tsx src/contexts/auth-context.tsx.backup

   # æ–°ã—ã„AuthProviderã‚’ä½¿ç”¨
   ```

3. **æ—¢å­˜ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®ç½®ãæ›ãˆ**

   ```bash
   # æ—¢å­˜ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   mv src/components/login-form.tsx src/components/login-form.tsx.backup

   # æ–°ã—ã„ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨
   ```

#### 4.4 ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

**`src/__tests__/auth.test.ts`**

```typescript
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { AuthProvider } from '@/components/auth/auth-provider';
import { LoginForm } from '@/components/auth/login-form';
import { supabase } from '@/lib/supabase/client';

// Supabaseã®ãƒ¢ãƒƒã‚¯
jest.mock('@/lib/supabase/client', () => ({
  supabase: {
    auth: {
      signInWithPassword: jest.fn(),
      signOut: jest.fn(),
      onAuthStateChange: jest.fn(),
      getSession: jest.fn(),
    },
  },
}));

describe('Auth System', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  test('ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(
      <AuthProvider>
        <LoginForm />
      </AuthProvider>
    );

    expect(screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹')).toBeInTheDocument();
    expect(screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰')).toBeInTheDocument();
    expect(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' })).toBeInTheDocument();
  });

  test('ãƒ­ã‚°ã‚¤ãƒ³ãŒæˆåŠŸã™ã‚‹', async () => {
    const mockUser = {
      id: '1',
      email: 'test@example.com',
      name: 'Test User',
      role: 'user',
    };

    (supabase.auth.signInWithPassword as jest.Mock).mockResolvedValue({
      data: {
        user: { id: '1', email: 'test@example.com' },
        session: { access_token: 'token' },
      },
      error: null,
    });

    render(
      <AuthProvider>
        <LoginForm />
      </AuthProvider>
    );

    fireEvent.change(screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'), {
      target: { value: 'test@example.com' },
    });
    fireEvent.change(screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'), {
      target: { value: 'password123' },
    });
    fireEvent.click(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' }));

    await waitFor(() => {
      expect(supabase.auth.signInWithPassword).toHaveBeenCalledWith({
        email: 'test@example.com',
        password: 'password123',
      });
    });
  });

  test('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãŒæˆåŠŸã™ã‚‹', async () => {
    (supabase.auth.signOut as jest.Mock).mockResolvedValue({
      error: null,
    });

    const { signOut } = useAuth();

    await signOut();

    expect(supabase.auth.signOut).toHaveBeenCalled();
  });
});
```

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: åŸºç›¤ã®æ§‹ç¯‰

- [x] å‹å®šç¾©ã®ä½œæˆ (`src/lib/auth/types.ts`)
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£… (`src/lib/auth/errors.ts`)
- [x] èªè¨¼è¨­å®šã®å®Ÿè£… (`src/lib/auth/config.ts`)
- [x] ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®å®Ÿè£… (`src/lib/auth/utils.ts`)
- [x] Supabaseè¨­å®šã®æœ€é©åŒ– (`src/lib/supabase/client.ts`, `src/lib/supabase/server.ts`)

### Phase 2: èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å®Ÿè£…

- [x] èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å®Ÿè£… (`src/components/auth/auth-provider.tsx`)
- [x] èªè¨¼ã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£… (`src/components/auth/auth-guard.tsx`)
- [x] ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®å®Ÿè£… (`src/components/auth/login-form.tsx`)
- [x] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ã®å®Ÿè£… (`src/components/ui/loading-spinner.tsx`)

### Phase 3: èªè¨¼æ“ä½œã®å®Ÿè£…

- [x] ã‚µãƒ¼ãƒãƒ¼å´èªè¨¼APIã®å®Ÿè£… (`src/server/routers/auth.ts`)
- [x] èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè£… (`src/lib/auth/middleware.ts`)

### Phase 4: çµ±åˆã¨ãƒ†ã‚¹ãƒˆ

- [x] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒˆã®æ›´æ–° (`src/app/layout.tsx`)
- [x] ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°
- [x] ãƒ†ã‚¹ãƒˆã®å®Ÿè£…
- [x] æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç½®ãæ›ãˆ
- [x] å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. åˆæœŸåŒ–ã®æœ€é©åŒ–

- **é…å»¶åˆæœŸåŒ–**: å¿…è¦ãªæ™‚ã®ã¿èªè¨¼çŠ¶æ…‹ã‚’åˆæœŸåŒ–
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: é©åˆ‡ãªèªè¨¼çŠ¶æ…‹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ä¸¦åˆ—å‡¦ç†**: èªè¨¼å‡¦ç†ã®ä¸¦åˆ—åŒ–

### 2. ãƒ¡ãƒ¢ãƒªç®¡ç†

- **ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®é˜²æ­¢**: é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **çŠ¶æ…‹ã®æœ€é©åŒ–**: æœ€å°é™ã®çŠ¶æ…‹ç®¡ç†
- **ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†**: é©åˆ‡ãªã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

- **é©åˆ‡ãªãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†**: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªå‡¦ç†
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™**: é©åˆ‡ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™ã®è¨­å®š
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–**: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã®ç¢ºå®Ÿãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–

### 2. ãƒ‡ãƒ¼ã‚¿ä¿è­·

- **æ©Ÿå¯†æƒ…å ±ã®ä¿è­·**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„ãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªä¿è­·
- **é€šä¿¡ã®æš—å·åŒ–**: HTTPSé€šä¿¡ã®ç¢ºä¿
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®é©åˆ‡ãªç®¡ç†

### 3. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- **ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: é©åˆ‡ãªæ¨©é™ç®¡ç†
- **èªè¨¼çŠ¶æ…‹ã®æ¤œè¨¼**: ã‚µãƒ¼ãƒãƒ¼å´ã§ã®èªè¨¼çŠ¶æ…‹ã®æ¤œè¨¼
- **ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®é˜²æ­¢**: é©åˆ‡ãªèªè¨¼ã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£…

## ç›£è¦–ã¨ãƒ­ã‚°

### 1. èªè¨¼ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–

**`src/lib/auth/logger.ts`**

```typescript
interface AuthLogEvent {
  type: 'login' | 'logout' | 'session_refresh' | 'error' | 'security';
  userId?: string;
  timestamp: string;
  details: Record<string, any>;
  ip?: string;
  userAgent?: string;
}

class AuthLogger {
  private logAuthEvent(event: AuthLogEvent) {
    // æœ¬ç•ªç’°å¢ƒã§ã¯å¤–éƒ¨ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡
    if (process.env.NODE_ENV === 'production') {
      // ä¾‹: Sentry, LogRocket, ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹
      console.log('Auth Event:', event);
    } else {
      console.log('Auth Event:', event);
    }
  }

  logLogin(userId: string, success: boolean, error?: string) {
    this.logAuthEvent({
      type: 'login',
      userId,
      timestamp: new Date().toISOString(),
      details: { success, error },
    });
  }

  logLogout(userId: string) {
    this.logAuthEvent({
      type: 'logout',
      userId,
      timestamp: new Date().toISOString(),
      details: {},
    });
  }

  logError(error: Error, context: Record<string, any> = {}) {
    this.logAuthEvent({
      type: 'error',
      timestamp: new Date().toISOString(),
      details: {
        message: error.message,
        stack: error.stack,
        ...context,
      },
    });
  }

  logSecurityEvent(
    event: string,
    userId?: string,
    details: Record<string, any> = {}
  ) {
    this.logAuthEvent({
      type: 'security',
      userId,
      timestamp: new Date().toISOString(),
      details: { event, ...details },
    });
  }
}

export const authLogger = new AuthLogger();
```

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

**`src/lib/auth/performance.ts`**

```typescript
class AuthPerformanceMonitor {
  private metrics: Map<string, number[]> = new Map();

  startTimer(operation: string): () => void {
    const start = performance.now();
    return () => {
      const duration = performance.now() - start;
      this.recordMetric(operation, duration);
    };
  }

  private recordMetric(operation: string, duration: number) {
    if (!this.metrics.has(operation)) {
      this.metrics.set(operation, []);
    }
    this.metrics.get(operation)!.push(duration);
  }

  getMetrics(operation: string) {
    const values = this.metrics.get(operation) || [];
    if (values.length === 0) return null;

    const sorted = values.sort((a, b) => a - b);
    return {
      count: values.length,
      min: sorted[0],
      max: sorted[sorted.length - 1],
      avg: values.reduce((a, b) => a + b, 0) / values.length,
      p95: sorted[Math.floor(sorted.length * 0.95)],
    };
  }

  getAllMetrics() {
    const result: Record<string, any> = {};
    for (const [operation] of this.metrics) {
      result[operation] = this.getMetrics(operation);
    }
    return result;
  }
}

export const authPerformance = new AuthPerformanceMonitor();
```

### 3. ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«

**`src/lib/auth/debug.ts`**

```typescript
class AuthDebugger {
  private isEnabled = process.env.NODE_ENV === 'development';

  log(message: string, data?: any) {
    if (this.isEnabled) {
      console.log(`[Auth Debug] ${message}`, data);
    }
  }

  warn(message: string, data?: any) {
    if (this.isEnabled) {
      console.warn(`[Auth Debug] ${message}`, data);
    }
  }

  error(message: string, error?: Error) {
    if (this.isEnabled) {
      console.error(`[Auth Debug] ${message}`, error);
    }
  }

  group(label: string) {
    if (this.isEnabled) {
      console.group(`[Auth Debug] ${label}`);
    }
  }

  groupEnd() {
    if (this.isEnabled) {
      console.groupEnd();
    }
  }
}

export const authDebug = new AuthDebugger();
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œãªã„

**åŸå› **: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ
**è§£æ±ºæ–¹æ³•**: `initializeAuth`é–¢æ•°ã®å®Ÿè£…ã‚’ç¢ºèªã—ã€é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹

#### 2. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œãªã„

**åŸå› **: ãƒ«ãƒ¼ã‚¿ãƒ¼ã®è¨­å®šã‚„èªè¨¼çŠ¶æ…‹ã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ
**è§£æ±ºæ–¹æ³•**: `signOut`é–¢æ•°å†…ã§é©åˆ‡ã«ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã€èªè¨¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹

#### 3. å‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

**åŸå› **: å‹å®šç¾©ã®ä¸æ•´åˆ
**è§£æ±ºæ–¹æ³•**: å‹å®šç¾©ã‚’ç¢ºèªã—ã€é©åˆ‡ãªå‹ã‚­ãƒ£ã‚¹ãƒˆã‚’è¡Œã†

#### 4. èªè¨¼ã‚¬ãƒ¼ãƒ‰ãŒæ­£ã—ãå‹•ä½œã—ãªã„

**åŸå› **: èªè¨¼çŠ¶æ…‹ã®ç›£è¦–ã‚„æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å•é¡Œ
**è§£æ±ºæ–¹æ³•**: `AuthGuard`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ã‚’ç¢ºèªã—ã€é©åˆ‡ãªæ¡ä»¶åˆ†å²ã‚’è¡Œã†

## å®Ÿè£…å¾Œã®æ¤œè¨¼æ‰‹é †

### 1. æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ‰‹é †**

```bash
# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
pnpm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
pnpm test:coverage

# E2Eãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
pnpm test:e2e
```

**æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé …ç›®**

- [ ] ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
  - [ ] æ­£å¸¸ãªãƒ­ã‚°ã‚¤ãƒ³
  - [ ] ç„¡åŠ¹ãªèªè¨¼æƒ…å ±ã§ã®ãƒ­ã‚°ã‚¤ãƒ³
  - [ ] ç„¡åŠ¹åŒ–ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³
- [ ] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
  - [ ] æ­£å¸¸ãªãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å®Œå…¨ãªã‚¯ãƒªã‚¢
  - [ ] ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®ç¢ºèª
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒã®ãƒ†ã‚¹ãƒˆ
  - [ ] ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ
  - [ ] ãƒ–ãƒ©ã‚¦ã‚¶å†èµ·å‹•æ™‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™åˆ‡ã‚Œã®å‡¦ç†
- [ ] èªè¨¼ã‚¬ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ
  - [ ] æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  - [ ] æ¨©é™ä¸è¶³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  - [ ] é©åˆ‡ãªæ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
  - [ ] ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
  - [ ] äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šæ‰‹é †**

```bash
# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
pnpm test:performance

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–
pnpm test:memory

# ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®ç¢ºèª
pnpm analyze
```

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé …ç›®**

- [ ] åˆæœŸåŒ–æ™‚é–“ã®æ¸¬å®š
  - [ ] èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®åˆæœŸåŒ–æ™‚é–“ < 100ms
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒæ™‚é–“ < 200ms
  - [ ] åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“ < 500ms
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¢ºèª
  - [ ] èªè¨¼çŠ¶æ…‹ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ < 1MB
  - [ ] ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®ç¢ºèª
  - [ ] ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ç¢ºèª
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–°æ™‚é–“ < 50ms
  - [ ] èªè¨¼çŠ¶æ…‹å¤‰æ›´ã®å¿œç­”æ™‚é–“ < 10ms
  - [ ] å¤§é‡ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆæ‰‹é †**

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
pnpm test:security

# è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
pnpm audit

# ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
pnpm audit:fix
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆé …ç›®**

- [ ] ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®é˜²æ­¢ç¢ºèª
  - [ ] ãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
  - [ ] ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã§ã®ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
  - [ ] æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã§ã®ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèª
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é©åˆ‡ãªç„¡åŠ¹åŒ–
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºå®šæ”»æ’ƒã®é˜²æ­¢
  - [ ] CSRFæ”»æ’ƒã®é˜²æ­¢
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèª
  - [ ] ãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªæš—å·åŒ–
  - [ ] ãƒˆãƒ¼ã‚¯ãƒ³ã®å®‰å…¨ãªä¿å­˜
  - [ ] ãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªç„¡åŠ¹åŒ–

### 4. çµ±åˆãƒ†ã‚¹ãƒˆ

**çµ±åˆãƒ†ã‚¹ãƒˆæ‰‹é †**

```bash
# çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
pnpm test:integration

# APIçµ±åˆãƒ†ã‚¹ãƒˆ
pnpm test:api

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ
pnpm test:db
```

**çµ±åˆãƒ†ã‚¹ãƒˆé …ç›®**

- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµ±åˆ
  - [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å®Œå…¨ãªçµ±åˆ
  - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±åˆ
  - [ ] çŠ¶æ…‹åŒæœŸã®ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆ
  - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºãªå–å¾—
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã®æ­£ç¢ºãªä¿å­˜
  - [ ] ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§
- [ ] å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ
  - [ ] Supabaseèªè¨¼ã®çµ±åˆ
  - [ ] ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆ
  - [ ] ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆ

## ç·Šæ€¥æ™‚ã®å¯¾å¿œæ‰‹é †

### 1. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒåœæ­¢ã—ãŸå ´åˆ

**ç·Šæ€¥å¯¾å¿œæ‰‹é †**

```bash
# 1. ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã®ç¢ºèª
pnpm status:auth

# 2. ãƒ­ã‚°ã®ç¢ºèª
pnpm logs:auth

# 3. ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–
pnpm emergency:auth:enable

# 4. ã‚·ã‚¹ãƒ†ãƒ ã®å¾©æ—§
pnpm recovery:auth
```

**å¯¾å¿œé …ç›®**

1. **ç·Šæ€¥ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–**: ç®¡ç†è€…ç”¨ã®ç·Šæ€¥ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
   - [ ] ç·Šæ€¥ãƒ­ã‚°ã‚¤ãƒ³ç”¨ã®ç‰¹åˆ¥ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æœ‰åŠ¹åŒ–
   - [ ] ç®¡ç†è€…ç”¨ã®ä¸€æ™‚çš„ãªèªè¨¼ãƒã‚¤ãƒ‘ã‚¹
   - [ ] ç·Šæ€¥æ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ**: æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ‰‹å‹•å¾©å…ƒ
   - [ ] æœ‰åŠ¹ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ‰‹å‹•å¾©å…ƒ
   - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ã®æ‰‹å‹•å¾©å…ƒ
   - [ ] èªè¨¼çŠ¶æ…‹ã®æ‰‹å‹•åŒæœŸ
3. **ãƒ­ã‚°ã®ç¢ºèª**: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèªã¨åˆ†æ
   - [ ] èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª
   - [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª
   - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°ã®ç¢ºèª

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸå ´åˆ

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œæ‰‹é †**

```bash
# 1. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®ç¢ºèª
pnpm security:incident:check

# 2. å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–
pnpm security:session:invalidate:all

# 3. ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®åˆ†æ
pnpm security:logs:analyze

# 4. å½±éŸ¿ç¯„å›²ã®ç‰¹å®š
pnpm security:impact:assess
```

**å¯¾å¿œé …ç›®**

1. **å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–**: ç·Šæ€¥æ™‚ã®å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–
   - [ ] å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–
   - [ ] ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç„¡åŠ¹åŒ–
   - [ ] ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®ç„¡åŠ¹åŒ–
2. **ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ç¢ºèª**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®ç¢ºèª
   - [ ] ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª
   - [ ] ä¸æ­£ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œã®ç¢ºèª
   - [ ] æ¨©é™æ˜‡æ ¼ã®è©¦è¡Œã®ç¢ºèª
3. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**: å½±éŸ¿ã‚’å—ã‘ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
   - [ ] å½±éŸ¿ã‚’å—ã‘ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹å®š
   - [ ] å¼·åˆ¶çš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
   - [ ] å¤šè¦ç´ èªè¨¼ã®æœ‰åŠ¹åŒ–

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯¾å¿œæ‰‹é †**

```bash
# 1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã®ç‰¹å®š
pnpm performance:analyze

# 2. ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®š
pnpm performance:bottleneck:identify

# 3. æœ€é©åŒ–ã®é©ç”¨
pnpm performance:optimize

# 4. ç›£è¦–ã®å¼·åŒ–
pnpm monitoring:enhance
```

**å¯¾å¿œé …ç›®**

1. **èªè¨¼å‡¦ç†ã®æœ€é©åŒ–**
   - [ ] èªè¨¼å‡¦ç†ã®ä¸¦åˆ—åŒ–
   - [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€é©åŒ–
   - [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–
2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æœ€é©åŒ–**
   - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åŠ¹ç‡åŒ–
   - [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–
   - [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æœ€é©åŒ–
3. **ç›£è¦–ã®å¼·åŒ–**
   - [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã®å¼·åŒ–
   - [ ] ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š
   - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åé›†

## ä»Šå¾Œã®æ‹¡å¼µæ€§

### 1. å¤šè¦ç´ èªè¨¼

- **TOTP**: æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
- **SMSèªè¨¼**: SMSèªè¨¼ã®å®Ÿè£…
- **ç”Ÿä½“èªè¨¼**: ç”Ÿä½“èªè¨¼ã®å®Ÿè£…

### 2. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³

- **Googleèªè¨¼**: Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³
- **GitHubèªè¨¼**: GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³
- **ãã®ä»–ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**: ãã®ä»–ã®èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

### 3. é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†**: ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ã®èªè¨¼
- **åœ°ç†çš„åˆ¶é™**: åœ°ç†çš„åˆ¶é™ã®å®Ÿè£…
- **ç•°å¸¸æ¤œçŸ¥**: ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œçŸ¥

## å®Ÿè£…å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æœ€çµ‚ç¢ºèªé …ç›®

#### 1. ã‚³ãƒ¼ãƒ‰å“è³ª

- [x] TypeScriptã‚¨ãƒ©ãƒ¼ãŒ0ä»¶
- [ ] ESLintã‚¨ãƒ©ãƒ¼ãŒ0ä»¶
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ90%ä»¥ä¸Š
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒå…¨ã¦åˆæ ¼

#### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆãŒå…¨ã¦åˆæ ¼
- [x] è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ãŒã‚¯ãƒªãƒ¼ãƒ³
- [x] èªè¨¼ãƒ•ãƒ­ãƒ¼ãŒå®‰å…¨
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒé©åˆ‡

#### 3. æ©Ÿèƒ½æ€§

- [x] ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ
- [x] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒãŒæ­£å¸¸å‹•ä½œ
- [x] èªè¨¼ã‚¬ãƒ¼ãƒ‰ãŒæ­£å¸¸å‹•ä½œ
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡

#### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- [x] åˆæœŸåŒ–æ™‚é–“ãŒç›®æ¨™å€¤ä»¥å†…
- [x] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒç›®æ¨™å€¤ä»¥å†…
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒåŠ¹ç‡çš„
- [x] ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒç›®æ¨™å€¤ä»¥å†…

#### 5. ç›£è¦–ãƒ»ãƒ­ã‚°

- [x] èªè¨¼ã‚¤ãƒ™ãƒ³ãƒˆãŒé©åˆ‡ã«ãƒ­ã‚°å‡ºåŠ›
- [x] ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«ãƒ­ã‚°å‡ºåŠ›
- [x] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒåé›†
- [x] ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¨­å®šæ¸ˆã¿

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®æœ€çµ‚ç¢ºèª

```bash
# 1. å‹ãƒã‚§ãƒƒã‚¯
pnpm exec tsc --noEmit

# 2. ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
pnpm lint

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test

# 4. ãƒ“ãƒ«ãƒ‰ç¢ºèª
pnpm build

# 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
pnpm audit

# 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
pnpm test:performance
```

## ã¾ã¨ã‚

ã“ã®å®Ÿè£…æ–¹é‡ãƒ»æ‰‹é †æ›¸ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

### ğŸ¯ å®Œç’§ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´

1. **å …ç‰¢æ€§**: ã‚¨ãƒ©ãƒ¼ã«å¼·ãã€å®‰å®šã—ãŸèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
   - åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
   - é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
   - è‡ªå‹•å¾©æ—§æ©Ÿèƒ½

2. **æ‹¡å¼µæ€§**: å°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ã«å¯¾å¿œå¯èƒ½
   - ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ
   - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å¯èƒ½ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
   - è¨­å®šå¯èƒ½ãªèªè¨¼ãƒ•ãƒ­ãƒ¼

3. **ä¿å®ˆæ€§**: ç†è§£ã—ã‚„ã™ãã€ä¿å®ˆã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰
   - æ˜ç¢ºãªè²¬ä»»åˆ†é›¢
   - é©åˆ‡ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
   - åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆ

4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
   - å¤šå±¤é˜²å¾¡
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–
   - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æœ€é©åŒ–ã•ã‚ŒãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
   - åŠ¹ç‡çš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

6. **å‹å®‰å…¨æ€§**: TypeScriptã®å‹å®‰å…¨æ€§ã‚’æœ€å¤§é™æ´»ç”¨
   - å³å¯†ãªå‹å®šç¾©
   - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡º
   - å®Ÿè¡Œæ™‚å‹ãƒã‚§ãƒƒã‚¯

### ğŸš€ å®Ÿè£…ã®æˆåŠŸè¦å› 

- **æ®µéšçš„å®Ÿè£…**: 4ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ãŸæ®µéšçš„å®Ÿè£…
- **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ**: å˜ä½“ã€çµ±åˆã€E2Eã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- **è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: å®Ÿè£…æ‰‹é †ã‹ã‚‰ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¾ã§
- **ç›£è¦–ãƒ»ãƒ­ã‚°**: æœ¬ç•ªç’°å¢ƒã§ã®é‹ç”¨ã«å¿…è¦ãªç›£è¦–æ©Ÿèƒ½
- **ç·Šæ€¥å¯¾å¿œ**: ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿæ™‚ã®å¯¾å¿œæ‰‹é †

### ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

- **é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š**: æ˜ç¢ºãªå®Ÿè£…æ‰‹é †ã«ã‚ˆã‚‹é–‹ç™ºæ™‚é–“ã®çŸ­ç¸®
- **å“è³ªã®å‘ä¸Š**: åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹å“è³ªã®ç¢ºä¿
- **é‹ç”¨ã®å®‰å®šåŒ–**: é©åˆ‡ãªç›£è¦–ãƒ»ãƒ­ã‚°ã«ã‚ˆã‚‹é‹ç”¨ã®å®‰å®šåŒ–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–**: å¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–
- **ä¿å®ˆæ€§ã®å‘ä¸Š**: ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆã«ã‚ˆã‚‹ä¿å®ˆæ€§ã®å‘ä¸Š

å„ãƒ•ã‚§ãƒ¼ã‚ºã‚’é †ç•ªã«å®Ÿè£…ã—ã€å‹•ä½œç¢ºèªã‚’è¡Œã„ãªãŒã‚‰é€²ã‚ã‚‹ã“ã¨ã§ã€å®Œç’§ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã®å•é¡Œã‚„èªè¨¼é–¢é€£ã®ã‚¨ãƒ©ãƒ¼ãŒè§£æ±ºã•ã‚Œã€å …ç‰¢ã§æ‹¡å¼µæ€§ã®é«˜ã„èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚
